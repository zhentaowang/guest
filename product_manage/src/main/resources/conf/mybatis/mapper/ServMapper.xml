<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.airportcloud.productmanage.mapper.ServMapper">
  <resultMap id="BaseResultMap" type="com.airportcloud.productmanage.model.Serv">
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="airport_code" jdbcType="VARCHAR" property="airportCode" />
    <result column="product_type_allocation_id" jdbcType="BIGINT" property="productTypeAllocationId" />
    <result column="no" jdbcType="VARCHAR" property="no" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="depart_type" jdbcType="VARCHAR" property="departType" />
    <result column="terminal" jdbcType="VARCHAR" property="terminal" />
    <result column="is_security_check" jdbcType="SMALLINT" property="isSecurityCheck" />
    <result column="available_gate" jdbcType="VARCHAR" property="availableGate" />
    <result column="region" jdbcType="VARCHAR" property="region" />
    <result column="address_detail" jdbcType="VARCHAR" property="addressDetail" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="is_deleted" jdbcType="SMALLINT" property="isDeleted" />
  </resultMap>
  <resultMap id="BaseResultMapPage" type="com.airportcloud.productmanage.model.Serv">
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="airport_code" jdbcType="VARCHAR" property="airportCode" />
    <result column="product_type_allocation_id" jdbcType="BIGINT" property="productTypeAllocationId" />
    <result column="no" jdbcType="VARCHAR" property="no" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="depart_type" jdbcType="VARCHAR" property="departType" />
    <result column="terminal" jdbcType="VARCHAR" property="terminal" />
    <result column="is_security_check" jdbcType="SMALLINT" property="isSecurityCheck" />
    <result column="available_gate" jdbcType="VARCHAR" property="availableGate" />
    <result column="region" jdbcType="VARCHAR" property="region" />
    <result column="address_detail" jdbcType="VARCHAR" property="addressDetail" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="is_deleted" jdbcType="SMALLINT" property="isDeleted" />
    <result column="product_category" jdbcType="VARCHAR" property="productCategory" />
    <result column="service_type" jdbcType="VARCHAR" property="serviceType" />
    <result column="price" jdbcType="DECIMAL" property="price" />
    <result column="over_staff_unit_price" jdbcType="DECIMAL" property="overStaffUnitPrice" />
    <result column="free_retinue_num" jdbcType="BIGINT" property="freeRetinueNum" />
  </resultMap>

  <resultMap id="DropdownlistMap" type="com.airportcloud.productmanage.model.Dropdownlist">
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="value" jdbcType="VARCHAR" property="value" />
  </resultMap>

  <sql id="Base_Column_List">
    id, airport_code, product_type_allocation_id, no, name, depart_type, terminal, is_security_check,
    available_gate, region, address_detail, create_time, update_time, is_deleted
  </sql>

  <select id="selectById" parameterType="map" resultMap="BaseResultMapPage">
    SELECT
    s.*,product_category,service_type
    FROM
    serv s left join product_type_allocation p on s.product_type_allocation_id = p.id
    where s.airport_code = #{airportCode,jdbcType=VARCHAR} and s.id = #{id,jdbcType=BIGINT} and s.is_deleted = 0
  </select>

  <select id="getCurrentValue"  resultType="java.lang.Integer">
    select  NEXTVAL('serv')
  </select>

  <update id="updateByIdAndAirportCode" parameterType="com.airportcloud.productmanage.model.Serv">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update serv
  <set>
    <if test="name != null">
      name = #{name,jdbcType=VARCHAR},
    </if>
    <if test="departType != null">
      depart_type = #{departType,jdbcType=VARCHAR},
    </if>
    <if test="terminal != null">
      terminal = #{terminal,jdbcType=VARCHAR},
    </if>
    <if test="isSecurityCheck != null">
      is_security_check = #{isSecurityCheck,jdbcType=SMALLINT},
    </if>
    <if test="availableGate != null">
      available_gate = #{availableGate,jdbcType=VARCHAR},
    </if>
    <if test="region != null">
      region = #{region,jdbcType=VARCHAR},
    </if>
    <if test="addressDetail != null">
      address_detail = #{addressDetail,jdbcType=VARCHAR},
    </if>
    <if test="isDeleted != null">
      is_deleted = #{isDeleted,jdbcType=SMALLINT},
    </if>
      update_time = CURRENT_TIMESTAMP
  </set>
  where airport_code = #{airportCode,jdbcType=VARCHAR} and id = #{id,jdbcType=BIGINT}
</update>

  <select id="getListByConidition" parameterType="com.airportcloud.productmanage.pageUtil.BasePagination" resultMap="BaseResultMapPage">
    SELECT
    s.*,product_category,service_type
    FROM
    v_serv s left join product_type_allocation p on s.product_type_allocation_id = p.id
    where s.airport_code = #{criteria.airportCode,jdbcType=VARCHAR} and s.is_deleted = 0
    <if test="criteria.productCategory != null and !criteria.productCategory.trim().equals('')" >
      and p.product_category like concat('%',#{criteria.productCategory},'%')
    </if>
    <if test="criteria.serviceType != null and !criteria.serviceType.trim().equals('')" >
      and p.service_type = #{criteria.serviceType}
    </if>
    <if test="criteria.name != null and !criteria.name.trim().equals('')" >
      and s.name like concat('%',#{criteria.name},'%')
    </if>
    order by s.id desc
    LIMIT #{page.startPageNo},#{page.pCount}
  </select>

  <select id="getServListByConidition" parameterType="com.airportcloud.productmanage.pageUtil.BasePagination" resultMap="BaseResultMapPage">
    SELECT
    s.*,product_category,service_type
    FROM
    v_serv s left join product_type_allocation p on s.product_type_allocation_id = p.id
    where s.airport_code = #{airportCode,jdbcType=VARCHAR} and s.product_type_allocation_id = #{productTypeAllocationId,jdbcType=BIGINT} and s.is_deleted = 0
    order by s.id desc
  </select>

  <select id="getListCount" parameterType="map" resultType="int">
    SELECT
    count(m.id) as num
    FROM
    serv m left join product_type_allocation p on m.product_type_allocation_id = p.id
    where m.airport_code = #{airportCode,jdbcType=VARCHAR} and m.is_deleted = 0
    <if test="productCategory != null and !productCategory.trim().equals('')" >
      and p.product_category like concat('%',#{productCategory},'%')
    </if>
    <if test="serviceType != null and !serviceType.trim().equals('')" >
      and p.service_type = #{serviceType}
    </if>
    <if test="name != null and !name.trim().equals('')" >
      and m.name like concat('%',#{name},'%')
    </if>
  </select>

  <delete id="deleteByIdAndAirportCode">
    delete
    from
    serv
    where airport_code = #{airportCode,jdbcType=VARCHAR} and id = #{id,jdbcType=BIGINT}
  </delete>

  <select id="getIdByCondition"  parameterType="java.util.Map"  resultType="java.lang.Long">
    SELECT id from serv where airport_code = #{airportCode,jdbcType=VARCHAR} and name = #{serviceName,jdbcType=VARCHAR}
  </select>

  <select id="getServiceNameDropdownList" parameterType="java.util.Map" resultMap="DropdownlistMap">
    select id,name as value from serv where airport_code = #{airportCode,jdbcType=VARCHAR} and product_type_allocation_id = #{id,jdbcType=BIGINT} and is_deleted = 0
  </select>

</mapper>